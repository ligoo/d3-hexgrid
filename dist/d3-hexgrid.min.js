!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).d3={})}(this,function(t){"use strict";function e(t,e){return t<e?-1:e<t?1:e<=t?0:NaN}function f(t){return null===t?NaN:+t}function n(t,e,n){return n<=t?t:(console.warn(e+` should be ${n} or greater. Coerced to ${n}.`),n)}function o(t,e){t=function(t,e){var n,r,o,i=t.length,a=-1;if(null==e){for(;++a<i;)if(null!=(n=t[a])&&n<=n)for(r=o=n;++a<i;)null!=(n=t[a])&&(n<r&&(r=n),o<n)&&(o=n)}else for(;++a<i;)if(null!=(n=e(t[a],a,t))&&n<=n)for(r=o=n;++a<i;)null!=(n=e(t[a],a,t))&&(n<r&&(r=n),o<n)&&(o=n);return[r,o]}(t.coordinates[0].map(t=>e(t)[1]));return(t[1]-t[0])/2}var i=1e-6,a=Math.PI,r=a/2,p=2*a,l=180/a,v=a/180,u=Math.abs,h=Math.atan2,d=Math.cos,g=Math.sin,c=Math.sqrt;function y(t){return 1<t?r:t<-1?-r:Math.asin(t)}function m(t){return function(){return t}}function x(t,e){return[u(t)>a?t+Math.round(-t/p)*p:t,e]}function s(n){return function(t,e){return[a<(t+=n)?t-p:t<-a?t+p:t,e]}}function M(t){var e=s(t);return e.invert=s(-t),e}function P(t,e){var o=d(t),i=g(t),a=d(e),l=g(e);function n(t,e){var n=d(e),r=d(t)*n,t=g(t)*n,n=g(e),e=n*o+r*i;return[h(t*a-e*l,r*o-n*i),y(e*a+t*l)]}return n.invert=function(t,e){var n=d(e),r=d(t)*n,t=g(t)*n,n=g(e),e=n*a-t*l;return[h(t*a+n*l,r*o+e*i),y(e*o-r*i)]},n}function w(t,e,n,r,o,i){if(n){var a=d(e),l=g(e),u=r*n;null==o?(o=e+r*p,i=e-u/2):(o=k(a,o),i=k(a,i),(0<r?o<i:i<o)&&(o+=r*p));for(var c,s=o;0<r?i<s:s<i;s-=u)c=[a,-l*d(s),-l*g(s)],c=[h(c[1],c[0]),y(c[2])],t.point(c[0],c[1])}}function k(t,e){r=(o=e)[0],o=o[1],n=d(o),(e=[n*d(r),n*g(r),g(o)])[0]-=t,r=c((n=e)[0]*n[0]+n[1]*n[1]+n[2]*n[2]),n[0]/=r,n[1]/=r,n[2]/=r;var n,r,o,t=1<(o=-e[1])?0:o<-1?a:Math.acos(o);return((-e[2]<0?-t:t)+p-i)%p}function b(){var c,s,f=m([0,0]),h=m(90),d=m(6),g={point:function(t,e){c.push(t=s(t,e)),t[0]*=l,t[1]*=l}};function e(){var t,e,n,r,o,i=f.apply(this,arguments),a=h.apply(this,arguments)*v,l=d.apply(this,arguments)*v;function u(t,e){return t=r(t,e),o(t[0],t[1])}return c=[],t=-i[0]*v,e=-i[1]*v,n=0,s=((t%=p)?e||n?(r=M(t),o=P(e,n),r.invert&&o.invert&&(u.invert=function(t,e){return(t=o.invert(t,e))&&r.invert(t[0],t[1])}),u):M(t):e||n?P(e,n):x).invert,w(g,a,l,1),i={type:"Polygon",coordinates:[c]},c=s=null,i}return e.center=function(t){return arguments.length?(f="function"==typeof t?t:m([+t[0],+t[1]]),e):f},e.radius=function(t){return arguments.length?(h="function"==typeof t?t:m(+t),e):h},e.precision=function(t){return arguments.length?(d="function"==typeof t?t:m(+t),e):d},e}function C(t,e,n,r){t=t/("m"===function(t){let e=t.toLowerCase();if("m"!==e&&"km"!==e)if("kilometres"===e||"kilometre"===e||"kilometers"===e||"kilometer"===e)e="km";else{if("miles"!==e&&"mile"!==e)throw new Error('Please provide the unit identifier as either "km" for kilometres or "m" for miles');e="m"}return e}(e)?3959:6371)*(180/Math.PI),e=b().radius(t).center(n.invert(r)),r=o(e(),n);return{circlePolygon:e,radiusDegrees:t,radiusPixel:r}}x.invert=x;var E=Math.PI/3,D=[0,E,2*E,3*E,4*E,5*E];function I(t){return t[0]}function j(t){return t[1]}function W(t,e){return l=a=0,c=u=1,p=I,v=j,n.hexagon=function(t){return"m"+r(null==t?i:+t).join("l")+"z"},n.centers=function(){for(var t=[],e=Math.round(l/g),n=Math.round(a/d),r=e*g;r<c+i;r+=g,++e)for(var o=n*d+(1&e)*d/2;o<u+d/2;o+=d)t.push([o,r]);return t},n.mesh=function(){var e=r(i).slice(0,4).join("l");return n.centers().map(function(t){return"M"+t+"m"+e}).join("")},n.x=function(t){return arguments.length?(p=t,n):p},n.y=function(t){return arguments.length?(v=t,n):v},n.radius=function(t){return arguments.length?(d=2*(i=+t)*Math.sin(E),g=1.5*i,n):i},n.size=function(t){return arguments.length?(a=l=0,u=+t[0],c=+t[1],n):[u-a,c-l]},n.extent=function(t){return arguments.length?(a=+t[0][0],l=+t[0][1],u=+t[1][0],c=+t[1][1],n):[[a,l],[u,c]]},n.radius(1).extent(t).radius(e).x(t=>t.x).y(t=>t.y);function n(t){for(var e,n,r,o,i,a,l,u,c={},s=[],f=t.length,h=0;h<f;++h)isNaN(l=+p.call(null,e=t[h],h,t))||isNaN(u=+v.call(null,e,h,t))||(n=Math.round(u/=g),r=Math.round(l=l/d-(1&n)/2),o=u-n,1<3*Math.abs(o)&&(a=l-(i=r+(l<r?-1:1)/2))*a+(u=u-(a=n+(u<n?-1:1)))*u<(u=l-r)*u+o*o&&(r=i+(1&n?1:-1)/2,n=a),(u=c[l=r+"-"+n])?u.push(e):(s.push(u=c[l]=[e]),u.x=(r+(1&n)/2)*d,u.y=n*g));return s}function r(o){var i=0,a=0;return D.map(function(t){var e=Math.sin(t)*o,t=-Math.cos(t)*o,n=e-i,r=t-a;return i=e,a=t,[n,r]})}var i,d,g,a,l,u,c,p,v}function N(t,e,n,r,o,i){var a=i*r,r=a+2*r,l=document.createElement("canvas"),l=([l.width,l.height]=t,l.getContext("2d",{willReadFrequently:!0})),u=e.context(l);return l.beginPath(),u(n),"fill"===o?(i&&(l.lineWidth=a,l.stroke()),l.fill()):"stroke"===o&&(l.lineWidth=r,l.stroke()),e.context(null),l.getImageData(0,0,t[0],t[1]).data.filter((t,e)=>e%4==3)}function O(e,t,n,r,o,i){var a,l,u,c=Math.sqrt(3)*o*e,s=2*o*e,f=document.createElement("canvas"),h=(f.width=c,f.height=s,f.getContext("2d")),d=Array(7);for(let t=0;t<7;t++){g={x:0,y:0},a=o*e,l=t,void 0,u={},l=Math.PI/180*(60*l-30),u.x=g.x+a*Math.cos(l),u.y=g.y+a*Math.sin(l);var g=u;d[t]=g}h.translate(c/2,s/2),function(e,t,n,r){if(r=3<arguments.length&&void 0!==r?r:"fill",e.beginPath(),t.forEach(t=>{0===t?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)}),e.closePath(),"fill"===r)e.fillStyle=n,e.fill();else{if("stroke"!==r)throw new Error("hexDraw action needs to be either 'fill' or 'stroke'");e.strokeStyle=n,e.stroke()}}(h,d,"red","fill");var[h,t]=t,p=document.createElement("canvas"),h=(p.width=h*e,p.height=t*e,p.getContext("2d")),t=(n.context(h),i*o),i=(h.scale(e,e),h.beginPath(),n(r),h.lineWidth=t,h.fillStyle="blue",h.strokeStyle="blue",h.stroke(),h.fill(),n.context(null),document.createElement("canvas")),r=(i.width=c,i.height=s,i.getContext("2d"));return{canvasHex:f,canvasImage:p,contextMix:r}}function S(t,r,e,o){if(!t.length)return[];n=t;const i=(e=e)&&2===e.length?e:(e=Object.keys(n[0]).filter(t=>{t=t.toLowerCase();return"longitude"===t||"lon"===t||"lng"===t||"long"===t||"lambda"===t}),n=Object.keys(n[0]).filter(t=>{t=t.toLowerCase();return"latitude"===t||"lat"===t||"phi"===t}),[e[0],n[0]]);var n;return t.map(e=>{var t=r([+e[i[0]],+e[i[1]]]);const n={};return[n.x,n.y]=t,o&&o.length&&o.forEach(t=>{n[t]=e[t]}),n})}function q(e,t){var n=function(t,e,n){var r,o;if(null==n&&(n=f),r=t.length)return(e=+e)<=0||r<2?+n(t[0],0,t):1<=e?+n(t[r-1],r-1,t):(r=(r-1)*e,(o=+n(t[e=Math.floor(r)],e,t))+(+n(t[e+1],e+1,t)-o)*(r-e))}(e.filter(t=>0<t.cover&&t.cover<1).map(t=>t.cover).sort((t,e)=>t-e),.1),r=1.5*Math.sqrt(3)*t**2;let o=0,i=0,a=0,l=e.length,u=e.length,c=e.length/r;for(let t=0;t<e.length;t++){var s=e[t];s.cover||(s.cover=n),s.datapointsWt=s.datapoints*(1/s.cover),s.pointDensity=s.datapoints/(r*s.cover),o=Math.max(o,s.datapoints),i=Math.max(i,s.datapointsWt),a=Math.max(a,s.pointDensity),0<s.datapoints&&(l=Math.min(l,s.datapoints),u=Math.min(u,s.datapointsWt)),0<s.pointDensity&&(c=Math.min(c,s.pointDensity))}return{layout:e,extentPoints:[l,o],extentPointsWeighted:[u,i],extentPointDensity:[c,a]}}t.geoPolygon=function(e,n){let r=[],o;try{if("FeatureCollection"===e.type)o=e.features;else{if("GeometryCollection"!==e.type)throw new Error('Geometry type not supported. Please feed me a "FeatureCollection" or a "GeometryCollection".');o=e.geometries}}catch(t){throw new Error(t)}for(let t=0;t<o.length;t++){var i,a="FeatureCollection"===e.type?e.features[t].geometry:e.geometries[t];a&&"Polygon"===a.type?(i=a.coordinates[0].map(t=>n(180<t[0]?[180,t[1]]:t)),r.push(i)):a&&"MultiPolygon"===a.type&&(i=a.coordinates.map(t=>t[0].map(t=>n(180<t[0]?[180,t[1]]:t))),r=r.concat(i))}return r},t.hexgrid=function(){let a,l,u,c,s=4,h=null,d=null,g=1,p=0,v;function r(t,e){d&&(n=C(d,h,u,a[1].map(t=>t/2)),s=n.radiusPixel),s=Math.round(2*s)/2;var n=W(a,s),r=n.size(),o=function(t,e,n){const r=n[0];return t.filter(t=>e[Math.floor(t.x)+r*Math.floor(t.y)])}(i=function(t,e,n){const[r,o]=n;return t.filter(t=>0<=t[0]&&t[0]<=r&&0<=t[1]&&t[1]<=o&&e[Math.floor(t[0])+Math.floor(t[1])*Math.floor(r)]).map((t,e)=>({id:e,x:t[0],y:t[1],gridpoint:1,cover:1}))}(n.centers(),N(r,c,l,s,"fill",p),r),N(r,c,l,s,"stroke",p),r);const f=O(g,r,c,l,s,p);var i=function(t,e){var n=t.slice(0);for(let t=0;t<e.length;t++){var r=e[t];n[r.id].cover=r.cover}return n}(i,o.map(t=>{{var r=f,o=g,i,{canvasHex:r,canvasImage:a,contextMix:l}=r,u=r.width,c=r.height,s=(l.drawImage(r,0,0),l.globalCompositeOperation="source-atop",l.drawImage(a,-t.x*o+u/2,-t.y*o+c/2),l.getImageData(0,0,u,c).data);let e=0,n=0;for(let t=3;t<s.length;t+=4)s[t]<100||(i=s[t-3],s[t-1]<i?e++:n++);return r=n/(e+n),(a=Object.assign({},t)).cover=r,l.clearRect(0,0,u,c),l.globalCompositeOperation="source-over",a}})),r=S(t,u,v,e),o=q(function(r){for(let t=0;t<r.length;t++){var o=r[t];let e,n;for(let t=0;t<o.length;t++)1===o[t].gridpoint&&(e=o[t].cover,n=1,o.splice(t,1));r[t].datapoints=r[t].length,r[t].cover=e,r[t].gridpoint=n||0}return r}(n(i.concat(r))),s);return n.grid={},n.grid.layout=o.layout,n.grid.imageCenters=i,n.grid.extentPoints=o.extentPoints,n.grid.extentPointsWeighted=o.extentPointsWeighted,n.grid.extentPointDensity=o.extentPointDensity,n}return r.extent=function(t){return arguments.length?(a=function(t){var e=Array.from(new Set(t.map(t=>t.length)))[0];let n=Array(2);if(2===e)n=t;else{if(void 0!==e)throw new Error("Check 'extent' is in the anticipated form [[x0,y0],[x1,y1]] or [x1,y1]");n=[[0,0],t]}return n}(t),r):a},r.geography=function(t){return arguments.length?(l=t,r):l},r.projection=function(t){return arguments.length?(u=t,r):u},r.pathGenerator=function(t){return arguments.length?(c=t,r):c},r.hexRadius=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!e.length)return h?{radius:s,unit:h}:s;if(1===e.length)return s=e[0],r;if(2===e.length)return[d,h]=e,r;throw new Error('Please pass a numeric radius and optionally a string distance unit ("miles" or "kilometres") to `.hexradius()`')},r.edgePrecision=function(t){return arguments.length?(g=n(t,"Edge precision",.3),r):g},r.gridExtend=function(t){return arguments.length?(p=n(t,"Edge band",0),r):p},r.geoKeys=function(t){return arguments.length?(v=t,r):v},r},t.polygonPoints=function(n,t){return t.reduce((t,h)=>{var e=n.filter(t=>{for(var e,n,r=h,t=[t.x,t.y],o=r.length,i=r[o-1],a=t[0],l=t[1],u=i[0],c=i[1],s=!1,f=0;f<o;++f)e=(i=r[f])[0],l<(n=i[1])!=l<c&&a<(u-e)*(l-n)/(c-n)+e&&(s=!s),u=e,c=n;return s});return t.concat(e)},[]).sort((t,e)=>t.x-e.x||t.y-e.y)},Object.defineProperty(t,"__esModule",{value:!0})});